#################################################
# VS2015
#################################################

job-windows-vs2015:

  extends: .job-prepare
  stage: build
  tags: [ "windows" ]
  
  cache:
    key: $CI_JOB_NAME
    paths:
      - clcache/
      
  before_script:
    - mkdir -p clcache
    - set CLCACHE_DIR=%cd%\clcache
    - echo repertoire courant %CLCACHE_DIR%
    - echo %Path%
    - echo %path%
    #- set path="C:\Program Files\Python37\Scripts;%path%"
    - echo %Path%
    - echo %path%
    - cd C:\Program Files\Python37\Scripts
    - pip install git+https://github.com/frerich/clcache.git
    - set CC=clcache
    - set CXX=clcache
    
  except:
    variables:
      - $DEPLOY_RUN_ANDROID
      - $DEPLOY_RUN_IOS
  variables:
    CMAKE_OPTIONS: -DENABLE_LIME_X3DH=NO

  script:
    #checking if "NUL" exists to check if the directory exists without generating %errorlevel% when it's the case
    - if not exists build-desktop\ mkdir build-desktop
    - cd build-desktop
    - cmake .. -G "Visual Studio 14 2015" -DLINPHONESDK_PLATFORM=Desktop -DCMAKE_BUILD_TYPE=Release %DEFAULT_CMAKE_OPTIONS% %CMAKE_OPTIONS%
    - cmake --build . --target sdk --config Release -- /maxcpucount

job-windows-vs2015-novideo:

  only:
    - schedules
  except:
    variables:
      - $FAST_LINUX_TESTS
  variables:
    CMAKE_OPTIONS: -DENABLE_VIDEO=NO
  extends: job-windows-vs2015
