job-debian9-yocto-sumo:
  stage: build
  tags: [ "docker-debian9-yocto" ]
#  only:
#    variables:
#      - $NIGHTLY_MASTER
  script:
    - export WORKSPACE_PATH="$CI_PROJECT_DIR"
   #update to latest version of meta-bc for   current branch (see docker file)
    - cd /home/build/poky/meta-bc
    - git pull
    - cd /home/build/poky
    - export BB_ENV_EXTRAWHITE="LINPHONE_SDK_REV LINPHONE_SDK_BRANCH"
    - export LINPHONE_SDK_REV="$CI_COMMIT_SHA"
    - export LINPHONE_SDK_BRANCH="$CI_COMMIT_BRANCH"
    - source oe-init-build-env
    - bitbake -c cleanall linphone-sdk 2>&1 | tee bitbake_build.log
    - bitbake -f linphone-sdk 2>&1 | tee bitbake_build_error.log
    - tar cvzf bitbake_build_logs.tgz `bitbake -e linphone-sdk | grep ^T= |cut -d'"' -f 2`
  artifacts:
    paths:
      - bitbake_build.log
      - bitbake_build_logs.tgz
      - tmp/deploy/ipk/**/linphone-sdk*.ipk
