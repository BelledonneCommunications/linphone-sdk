
job-debian9-yocto-sumo:
  stage: build
  tags: [ "docker-debian9" ]
  image: gitlab.linphone.org:4567/bc/public/linphone-sdk/bc-dev-yocto:latest
  cache:
    key: yocto-cache-key
    paths:
      - tmp/
      - deploy/
      - work/
      - work-shared/
      - sstate-cache/
      - downloads/
  before_script:
    - ln -sf ./yocto_build /home/build/poky/build
  script:
    - export WORKSPACE_PATH="$(pwd)"
    - cd /home/build/poky
    - export BB_ENV_EXTRAWHITE="LINPHONE_SDK_REV"
    - export LINPHONE_SDK_REV="$CI_COMMIT_SHA"
    - source oe-init-build-env
    - bitbake -f linphone-sdk 2>&1 | tee bitbake_build.log
    - cd $WORKSPACE_PATH
    - ln -sf /home/build/poky/build ./yocto_build
#Gitlab doesn't handle cache and artifacts paths outside of project workspace (/builds/$WORKSPACE/$PROJECT_NAME)
  artifacts:
    paths:
      - bitbake_build.log
      - tmp/deploy/ipk/**/linphone-sdk*.ipk
