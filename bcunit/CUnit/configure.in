dnl Process this file with autoconf to produce a configure script.
AC_INIT(CUnit, 2.0-2)
AM_INIT_AUTOMAKE(CUnit, 2.0-2)

PACKAGE=CUnit
VERSION=2.0
RELEASE=2

TOPDIR=`pwd`

CFLAGS="-DRELEASE=@RELEASE@ -Wall -W -pedantic -Wshadow -ansi -I${PWD}/CUnit/Headers"
LDFLAGS="-L${PWD}/CUnit/Sources"

AC_ARG_ENABLE(debug,
[  --enable-debug    enable debugging],
  [
		echo "++++++++++ Enabling debug mode compilation.";
		CFLAGS="$CFLAGS -D_DEBUG -g3 -Wall"
		LDFLAGS="$LDFLAGS -g"
	],
  [
		echo "---------- Disabling debug mode compilation."
	])

AM_CONDITIONAL(ENABLE_AUTOMATED, false)
AC_ARG_ENABLE(automated,
[  --enable-automated    enable automated mode compilation],
  [
		echo "++++++++++ Enabling automated(XML) mode compilation";
		AM_CONDITIONAL(ENABLE_AUTOMATED, true)
	],
  [
		echo "---------- Disabling automated(XML) mode compilation"
	])

AM_CONDITIONAL(ENABLE_CURSES, false)
AC_ARG_ENABLE(curses,
[  --enable-curses    enable curses mode compilation],
  [
		echo "++++++++++ Enabling curses mode compilation";
		AM_CONDITIONAL(ENABLE_CURSES, true)
	],
  [
		echo "---------- Disabling curse mode compilation"
	])

AC_ARG_ENABLE(memtrace,
[  --enable-memtrace    enable memory tracing],
  [
	echo "++++++++++ Enabling memtrace functionality at compile time.";
	CFLAGS="$CFLAGS -DMEMTRACE"
  ],
  [
	echo "---------- Disabling memtrace functionality at compile time."
  ])

# Check for programs.
AC_PROG_CC
AC_PROG_INSTALL
AC_PROG_RANLIB
AC_PROG_MAKE_SET

# Check for libraries
AC_CHECK_LIB(c, main)  dnl Check for -lc

# Check for standard functions
AC_CHECK_FUNC(malloc, [], [echo malloc not found; exit 1])
AC_CHECK_FUNC(free, [], [echo free not found; exit 1])
AC_CHECK_FUNC(calloc, [], [echo calloc not found; exit 1])
AC_CHECK_FUNC(realloc, [], [echo realloc not found; exit 1])

AC_CHECK_FUNC(strcpy, [], [echo strcpy not found; exit 1])
AC_CHECK_FUNC(strerror, [], [echo strerror not found; exit 1])

AC_CHECK_FUNC(fopen, [], [echo fopen not found; exit 1])
AC_CHECK_FUNC(fclose, [], [echo fclose not found; exit 1])
AC_CHECK_FUNC(fprintf, [], [echo fprintf not found; exit 1])
AC_CHECK_FUNC(setvbuf, [], [echo setvbuf not found; exit 1])

AC_CHECK_FUNC(time, [], [echo time not found; exit 1])
AC_CHECK_FUNC(ctime, [], [echo ctime not found; exit 1])

# Check for header files.
AC_HEADER_STDC
AC_CHECK_HEADERS(assert.h)
AC_CHECK_HEADERS(ctype.h)
AC_CHECK_HEADERS(math.h)
AC_CHECK_HEADERS(file.h)
AC_CHECK_HEADERS(stdio.h)
AC_CHECK_HEADERS(stdlib.h)
AC_CHECK_HEADERS(string.h)

AM_CONFIG_HEADER(config.h)

# Check for typedefs, structures, and compiler characteristics.
AC_C_CONST

# Configure Jamrules for user environment
AC_CONFIG_FILES([Jamrules:Jamrules.in])

# Set environment variables.
AC_SUBST(PACKAGE)
AC_SUBST(VERSION)
AC_SUBST(RELEASE)

# Configure Makefile set.
AC_CONFIG_FILES( Makefile \
		CUnit.spec \
		CUnit/Makefile \
		CUnit/Headers/Makefile \
		CUnit/Headers/CUnit.h \
		CUnit/Sources/Makefile \
		CUnit/Sources/Framework/Makefile \
		CUnit/Sources/Automated/Makefile \
		CUnit/Sources/Basic/Makefile \
		CUnit/Sources/Console/Makefile \
		CUnit/Sources/Curses/Makefile \
		CUnit/Sources/Test/Makefile \
		doc/Makefile \
		doc/headers/Makefile \
		Examples/Makefile \
		Examples/AutomatedTest/Makefile \
		Examples/BasicTest/Makefile \
		Examples/ConsoleTest/Makefile \
		Examples/CursesTest/Makefile \
		Man/Makefile \
		Man/man3/Makefile \
		Share/Makefile )

AC_OUTPUT

